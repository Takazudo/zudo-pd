---
sidebar_position: 1
---

# CH224D - USB Power Delivery Controller

USB Power Delivery protocol negotiation IC for obtaining 15V/3A power from USB-C PD chargers.

## Overview

The CH224D is a USB Power Delivery (PD) protocol controller IC manufactured by WCH (Nanjing Qinheng Microelectronics). In this project, it communicates with USB-C PD chargers to negotiate 15V output, which serves as the input voltage for the modular synthesizer power supply.

Through CFG pin configuration, it can select PD voltage profiles of 5V/9V/12V/15V/20V without requiring an external microcontroller. The compact QFN-20 package minimizes PCB footprint while achieving low cost and high reliability.

## Key Specifications

| Parameter | Value | Notes |
|-----------|-------|-------|
| **JLCPCB Part Number** | C347423 | |
| **Manufacturer Part Number** | CH224D | |
| **Package** | QFN-20 (3mm × 3mm) | Surface-mount |
| **Stock Availability** | 30,829 units | Good availability |
| **Unit Price** | $0.32 | JLCPCB pricing |
| **Input Voltage Range** | 5V - 20V DC | From USB-C VBUS |
| **Output Voltage Options** | 5V / 9V / 12V / 15V / 20V | PD negotiated |
| **Maximum Current** | 3A | Depends on PD source capability |
| **PD Protocol Support** | USB PD 2.0 / 3.0 | |
| **Configuration Method** | Resistor-based CFG pins | No MCU required |
| **Operating Temperature** | -40°C to +85°C | |
| **Power Good Output** | PG pin (open drain) | Active low |

## Pin Configuration

```
          CH224D (QFN-20)
           Top View
    ┌─────────────────────────┐
    │                         │
CC1 │1                    20│ VHV
CC2 │2                    19│ VBUS (Input)
CFG3│3                    18│ VOUT (Output)
DP  │4                    17│ (Reserved)
DM  │5                    16│ (Reserved)
    │                       │
GND │6                    15│ GND
CFG1│7                    14│ CFG2
PG  │8                    13│ (Reserved)
    │9                    12│ (Reserved)
    │10                   11│ EP
    │    ┌──────────┐        │
    └────┤ Exposed  ├────────┘
         │   Pad    │
         └──────────┘
```

### Pin Descriptions

| Pin | Name | Function | Connection in Design |
|-----|------|----------|---------------------|
| 1 | CC1 | USB Type-C Configuration Channel 1 | USB-C connector CC1 |
| 2 | CC2 | USB Type-C Configuration Channel 2 | USB-C connector CC2 |
| 3 | CFG3 | Voltage configuration pin 3 / I2C data (optional) | Open (no connection) |
| 4 | DP | USB D+ data line | Not used (power-only mode) |
| 5 | DM | USB D- data line | Not used (power-only mode) |
| 6, 15 | GND | Ground | System ground plane |
| 7 | CFG1 | Voltage configuration pin 1 | GND (selects 15V) |
| 8 | PG | Power Good output (open drain, active low) | LED indicator via resistor |
| 11, EP | EP | Exposed Pad | Connect to GND for thermal |
| 14 | CFG2 | Voltage configuration pin 2 / I2C clock (optional) | Open (no connection) |
| 18 | VOUT | Regulated output voltage from PD negotiation | +15V rail output |
| 19 | VBUS | USB-C VBUS input | USB-C connector VBUS |
| 20 | VHV | High voltage input | Connect to VOUT |

## Application Circuit

```
USB-C Connector              CH224D                          Output
┌──────────────┐         ┌──────────────┐
│              │         │              │
│VBUS (B9,A9)  ├─┬───────┤19 VBUS   VOUT├18──┬───────→ +15V OUT
│              │ │       │              │    │
│CC1 (A5)      ├─┼───────┤1  CC1    VHV ├20──┘
│CC2 (B5)      ├─┼───────┤2  CC2        │
│              │ │       │              │
│GND (A12,B12) ├─┼───────┤6  GND    CFG1├7────── GND
│              │ │       │      15  CFG2├14───── Open
│              │ │       │         CFG3 ├3────── Open
└──────────────┘ │       │              │
                 │       │    EP, GND   ├11,15── GND
                 │       │              │
               C1│10µF   │    PG ───────┤8──┬─→ LED1 (Red)
                 │       │              │   │   via R1: 330Ω
               C2│10µF   └──────────────┘  GND
                 │
                GND

Connection List:
- J1 (USB-C) VBUS (B9, A9) → C1 (+), C2 (+) → U1 (CH224D) VBUS (pin 19), VHV (pin 20)
- J1 (USB-C) CC1 (A5) → U1 (CH224D) CC1 (pin 1)
- J1 (USB-C) CC2 (B5) → U1 (CH224D) CC2 (pin 2)
- J1 (USB-C) GND (A12, B12) → C1 (-), C2 (-) → U1 (CH224D) GND (pins 6, 15), EP (pin 11)
- U1 (CH224D) VOUT (pin 18) → VHV (pin 20) → +15V output rail
- U1 (CH224D) CFG1 (pin 7) → GND (selects 15V mode)
- U1 (CH224D) CFG2 (pin 14) → Open (no connection)
- U1 (CH224D) CFG3 (pin 3) → Open (no connection)
- U1 (CH224D) PG (pin 8) → R1 (330Ω) → LED1 (Red, anode) → LED1 (cathode) → GND
```

## Component Values

### Input Capacitors

| Reference | Value | Type | Voltage | Package | Part Number | Purpose |
|-----------|-------|------|---------|---------|-------------|---------|
| C1, C2 | 10µF | Ceramic X5R | 25V | 0805 | C15850 | VBUS decoupling and noise filtering |

**Note**: Two 10µF capacitors in parallel provide 20µF total capacitance for robust PD negotiation and transient response.

### Power Good LED Circuit

| Reference | Part | Value | Package | Part Number | Purpose |
|-----------|------|-------|---------|-------------|---------|
| LED1 | Red LED | 2.0V @ 10mA | 0805 | C84256 | Power negotiation status indicator |
| R1 | Resistor | 330Ω | 0603 | C23138 | LED current limiting |

## CFG Pin Configuration for Voltage Selection

The CH224D selects output voltage based on CFG1, CFG2, and CFG3 pin states:

| CFG3 | CFG2 | CFG1 | Output Voltage |
|------|------|------|----------------|
| 0 | 0 | 0 | 5V |
| 0 | 0 | 1 | 9V |
| 0 | 1 | 0 | 12V |
| 0 | 1 | 1 | 15V ✅ **This design** |
| 1 | 0 | 0 | 20V |
| 1 | 0 | 1 | 5V (fallback) |
| 1 | 1 | 0 | 9V (fallback) |
| 1 | 1 | 1 | 12V (fallback) |

**Legend**: 0 = GND, 1 = Open (pulled up internally)

**This Design Configuration**:
- CFG1 = GND (0)
- CFG2 = Open (1)
- CFG3 = Open (0)
- **Result**: 15V output

## Design Considerations

### USB-C PD Negotiation Process

The CH224D follows this sequence:

1. **Initial Connection** (0-200ms):
   - USB-C connector makes physical contact
   - VBUS initially at 5V (default USB power)
   - CH224D detects CC1/CC2 orientation via pull-down resistors

2. **PD Negotiation** (200ms-500ms):
   - CH224D sends capability request via CC lines
   - PD source responds with available power profiles
   - CH224D requests 15V/3A profile (based on CFG pins)

3. **Voltage Transition** (500ms-1000ms):
   - PD source transitions VBUS from 5V → 15V
   - CH224D monitors voltage transition
   - PG pin goes low when 15V is stable

4. **Steady State** (&gt;1000ms):
   - VOUT provides stable 15V/3A
   - System can draw up to 45W total power
   - LED1 illuminates (power good indication)

**Timing Note**: Downstream circuits must handle ~1 second startup delay before full power is available.

### Input Capacitance Requirements

USB PD specification requires:

- **Minimum capacitance**: 10µF per port
- **Recommended capacitance**: 20µF for reliable operation
- **This design**: 2× 10µF = 20µF (meets specification)

Insufficient capacitance can cause:
- PD negotiation failures
- Voltage droops during current transients
- Premature PG assertion
- Unstable operation

### Power Good (PG) Pin Behavior

The PG pin is an open-drain output (active low):

```
Normal Operation:
    PG pin ───┬──── R1 (330Ω) ──┬──── LED1 ──┬──→ GND
              │                 │            │
           (Open drain)      (Anode)     (Cathode)

When PD is NOT negotiated (PG = High-Z):
- Internal pullup in CH224D keeps pin high
- LED1 is OFF
- Indicates: Waiting for negotiation or fault

When PD is negotiated successfully (PG = Low):
- CH224D pulls pin to GND
- Current flows: VCC → R1 → LED1 → GND
- LED1 illuminates
- Indicates: 15V available and stable
```

**LED Current Calculation**:
```
I_LED = (V_VCC - V_LED - V_PG) / R1
I_LED = (15V - 2.0V - 0.3V) / 330Ω
I_LED ≈ 38mA

⚠️ This exceeds safe LED current (20mA max)!

Recommended: Increase R1 to 1kΩ
I_LED = (15V - 2.0V - 0.3V) / 1000Ω = 12.7mA ✅
```

**Recommendation**: Use R1 = 1kΩ (C21190) instead of 330Ω for LED protection.

### PCB Layout Guidelines

Critical layout considerations for reliable PD operation:

1. **Exposed Pad Connection**:
   - Connect EP (pin 11) to GND with multiple vias
   - Minimum 4 thermal vias (0.3mm diameter)
   - Improves thermal dissipation and electrical ground

2. **CC Line Routing**:
   - Keep CC1 and CC2 traces short and equal length
   - Route directly from USB-C connector to CH224D
   - No vias if possible (maintain impedance)
   - Trace width: 0.15mm (6mil) typical

3. **Decoupling Capacitor Placement**:
   - C1, C2 within 5mm of VBUS pin (pin 19)
   - Place on same side as CH224D
   - Short, wide traces to GND

4. **VOUT Trace Width**:
   - Minimum 1.5mm width (50mil) for 3A current
   - Recommend 2mm or copper pour for better current handling
   - Calculate: I = 3A, ΔT = 10°C → width ≈ 1.5mm (1oz copper)

### QFN-20 Footprint Specifications

```
         Top View (PCB Pad Layout)

    ┌──────────────────────────┐
    │                          │
    │    Exposed Pad           │
    │    2.1mm × 2.1mm         │  ← Solder paste: 60-80% coverage
    │                          │     (use multiple smaller pads)
    │    Thermal Vias (4-6)    │
    │                          │
    └──────────────────────────┘

         ●    ●    ●    ●    ●
        Pin pads (0.25mm × 0.6mm)
        Pitch: 0.5mm

    Package size: 3mm × 3mm
    Exposed pad: 2.1mm × 2.1mm
    Pin width: 0.25mm
    Pin length: 0.6mm
    Pad pitch: 0.5mm
```

**Solder Paste Stencil Design**:
- Divide exposed pad into 4-9 smaller paste openings
- Reduces voiding and improves solder joint reliability
- Example: 4× squares (0.9mm × 0.9mm) with 0.3mm gaps

## Performance Characteristics

### PD Negotiation Success Rate

Based on CH224D specifications:

| Condition | Success Rate | Notes |
|-----------|--------------|-------|
| Standard PD chargers (USB-IF certified) | &gt;99% | Recommended |
| Generic USB-C chargers with PD | &gt;95% | Most work reliably |
| USB-C chargers without PD | 0% | Fallback to 5V only |
| Damaged/worn cables | Variable | Replace cable if issues |

### Output Voltage Accuracy

| Parameter | Specification | Typical Performance |
|-----------|--------------|---------------------|
| Output voltage (after negotiation) | 15V ±5% | 14.25V - 15.75V |
| Voltage ripple (at CH224D output) | &lt;50mVp-p | With recommended capacitors |
| Load regulation | ±2% | 0A to 3A load change |
| Response time to load step | &lt;100µs | 0A → 3A step |

**Note**: The LM2596S DC-DC converters downstream provide additional regulation, reducing these variations to &lt;±2% at final outputs.

### Current Capability

| PD Source Rating | Available Current | Power |
|-----------------|-------------------|--------|
| 15V/3A (45W) | 3A | 45W ✅ **Design target** |
| 15V/2A (30W) | 2A | 30W ⚠️ Marginal |
| 15V/1.5A (22.5W) | 1.5A | 22.5W ❌ Insufficient |

**Compatibility Note**: Most modern USB-C PD chargers support 45W+ (15V/3A), but verify your charger specification.

## Protection Features

### Built-in Protections

1. **Overvoltage Protection (OVP)**:
   - Threshold: &gt;22V
   - Action: Shuts down VOUT
   - Recovery: Automatic when VBUS returns to safe range

2. **Overcurrent Protection (OCP)**:
   - Handled by PD source
   - CH224D monitors current via CC communication
   - Source will limit or shut down if overcurrent detected

3. **Thermal Protection**:
   - Junction temperature limit: ~125°C
   - Automatic shutdown if overheating
   - Recovery: Automatic after cooling

### External Protection Recommended

The CH224D output should be protected:

```
CH224D VOUT ──┬─── F4: 3A Fuse ──┬─── D1: 18V TVS ──┬─→ To DC-DC Stage
              │  (Polyfuse)      │   (Transient)    │
              │                  │      ↓           │
              │                  └─────GND──────────┘
```

Protection stages:
1. **Fuse (F4)**: 3A polyfuse for overcurrent protection
2. **TVS Diode (D1)**: 18V TVS for voltage spike protection
3. **Bulk Capacitance**: Additional electrolytic cap for transient buffering

## Bill of Materials

| Designator | Part | Value | Package | JLCPCB Part # | Qty | Unit Price | Extended |
|------------|------|-------|---------|--------------|-----|------------|----------|
| U1 | CH224D | USB PD Controller | QFN-20 | C347423 | 1 | $0.32 | $0.32 |
| C1, C2 | Ceramic Cap | 10µF 25V X5R | 0805 | C15850 | 2 | $0.0099 | $0.020 |
| LED1 | LED | Red 0805 | 0805 | C84256 | 1 | $0.0126 | $0.013 |
| R1 | Resistor | 1kΩ ±1% | 0603 | C21190 | 1 | $0.0005 | $0.0005 |
| J1 | USB-C Connector | 16-pin receptacle | SMD | TBD | 1 | ~$0.50 | $0.50 |
| | | | | **Total** | | | **$0.85** |

**Note**: USB-C connector part number depends on physical design requirements (mid-mount, edge-mount, etc.).

## Alternative Parts

### Direct Replacements

| Part Number | Manufacturer | JLCPCB Part # | Stock | Price | Notes |
|-------------|--------------|--------------|-------|-------|-------|
| CH224D | WCH | C347423 | 30,829 | $0.32 | **Recommended** |
| CH224K | WCH | C970725 | 146,668 | $0.23 | Similar, check pinout |
| HUSB238 | HYNETEK | Check | Variable | ~$0.40 | Alternative PD controller |

**Recommendation**: CH224D (C347423) offers good stock availability and proven reliability.

### Voltage Configuration Alternatives

If different output voltage is needed:

| Target Voltage | CFG1 | CFG2 | CFG3 | Application |
|----------------|------|------|------|-------------|
| 5V | GND | GND | GND | USB devices, microcontrollers |
| 9V | GND | GND | Open | Portable audio equipment |
| 12V | GND | Open | GND | LED lighting, motors |
| 15V | GND | Open | Open | **This design** - modular synth |
| 20V | Open | GND | GND | Laptop power, high-power projects |

## Assembly and Testing

### Assembly Sequence

1. **Solder QFN-20 IC**:
   - Use hot air or reflow oven
   - Solder paste on all pads including exposed pad
   - Alignment critical (use fiducials)
   - Inspect with microscope for bridges

2. **Solder passive components**:
   - C1, C2 (0805 capacitors)
   - R1 (0603 resistor)
   - LED1 (0805 LED, watch polarity!)

3. **Solder USB-C connector**:
   - Align carefully (connector is large and can misalign easily)
   - Solder anchor pins first
   - Then solder signal pins
   - Finally solder shield pins

### Testing Procedure

**Pre-Power Tests** (no USB-C connected):

1. **Visual inspection**:
   - No solder bridges on QFN pins
   - Capacitors and resistor oriented correctly
   - LED polarity correct (check marking)
   - USB-C connector mechanically secure

2. **Continuity tests**:
   - CC1, CC2 pins connected to USB-C connector
   - VBUS connected to capacitors
   - GND continuous across board
   - No shorts between VBUS and GND

**Power-On Tests**:

1. **Initial connection**:
   - Connect USB-C PD charger (15V/3A capable)
   - Observe LED1 - should illuminate within 1 second
   - Measure VOUT: Should be 14.25V - 15.75V

2. **Load test**:
   - Connect electronic load set to 1A constant current
   - Verify voltage remains 14.25V - 15.75V
   - Increase load to 2A, verify regulation
   - Increase load to 3A (if charger supports), verify regulation

3. **PG pin verification**:
   - Disconnect charger
   - LED1 should turn OFF
   - Reconnect charger
   - LED1 should turn ON within 1 second

4. **Thermal test**:
   - Run 3A load for 10 minutes
   - Check CH224D temperature (should be &lt;60°C)
   - If &gt;70°C, check thermal vias and exposed pad solder

## Troubleshooting

| Symptom | Possible Cause | Solution |
|---------|----------------|----------|
| LED1 never turns on | PD negotiation failed | Check USB-C cable quality |
| | Charger doesn't support 15V | Use PD 3.0 charger with 15V profile |
| | CFG pins misconfigured | Verify CFG1=GND, CFG2=Open, CFG3=Open |
| | CH224D not soldered correctly | Inspect QFN solder joints under microscope |
| Output voltage is 5V | PD negotiation not occurring | Check CC1, CC2 connections |
| | Charger doesn't support PD | Replace with PD-compatible charger |
| Output voltage unstable | Insufficient capacitance | Add more decoupling capacitors |
| | Poor ground connection | Check GND plane continuity |
| | Cable resistance too high | Use shorter, higher quality USB-C cable |
| No output voltage | VBUS not connected | Check USB-C connector solder joints |
| | CH224D damaged | Replace IC |
| | Fuse blown (if installed) | Check for short circuit, replace fuse |
| LED1 very bright | R1 value too low (330Ω) | Replace with 1kΩ resistor |
| | LED rated for lower current | Use higher current LED or increase R1 |
| Intermittent operation | USB-C connector loose | Resolder or replace connector |
| | Cable damaged or low quality | Replace with certified USB-C cable |
| | Thermal shutdown occurring | Improve cooling, reduce load current |

## Related Components

- **Downstream**: LM2596S-ADJ converters (U2, U3, U4) - DC-DC conversion stage
- **Alternative USB PD ICs**: CH224K, HUSB238
- **Connectors**: USB Type-C receptacle (J1)

## References

- [CH224D Datasheet](https://www.wch-ic.com/downloads/file/366.html) - WCH (Chinese)
- [CH224D English Datasheet](https://www.wch-ic.com/downloads/CH224DS1_PDF.html) - WCH
- [JLCPCB Part C347423](https://jlcpcb.com/partdetail/C347423)
- [USB Power Delivery Specification 3.1](https://www.usb.org/document-library/usb-power-delivery)
- [USB Type-C Cable and Connector Specification](https://www.usb.org/document-library/usb-type-cr-cable-and-connector-specification-release-21)
- Related documentation: `/doc/docs/inbox/circuit-diagrams.md` - Diagram 1
